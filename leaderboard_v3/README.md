<p align="center">
    <img width="600" src="https://www.competitionlabs.com/wp-content/uploads/2020/01/Logo-v4.svg"><br/>
</p>

# Leaderboard Widgets V3

HTML/CSS and Vanilla JavaScript Competition Labs Leaderboard / Achievements / Inbox-Messaging widget

<p align="center">
    <img width="300" src="https://s3-eu-west-1.amazonaws.com/demo.competitionlabs.com/_widgets/mini-scoreboard-animation.gif"><br/>
</p>

Our widget "out of the box" is a product that you can use immediately by placing it on your existing game, on your website or anything that you need it to be used for. The widget is fully editable, re-adjustable, multilingual (all languages are supported), units of measure are also auto-generated by the system (all the currencies are pre defined in your private space) and it is a complementary product that gives the player a full in-depth gaming experience. All you have to do is:

[Read more here](https://complabs.atlassian.net/wiki/spaces/CLRAV/pages/842301445/The+Widget)

## Examples
* [Live Standard laoding examples](https://s3-eu-west-1.amazonaws.com/demo.competitionlabs.com/_widgets/examples/leaderboard_v3.html)
* [Live loader script examples](https://s3-eu-west-1.amazonaws.com/demo.competitionlabs.com/_widgets/examples/leaderboard_v3_loader.html)


<table style="border:none;">
    <tr>
        <td>
            <img width="250" src="https://s3-eu-west-1.amazonaws.com/demo.competitionlabs.com/_widgets/3.png" />
        </td>
        <td>
            <img width="214" src="https://s3-eu-west-1.amazonaws.com/demo.competitionlabs.com/_widgets/2.png" />
        </td>
        <td>
            <img width="250" src="https://s3-eu-west-1.amazonaws.com/demo.competitionlabs.com/_widgets/1.png" />
        </td>
    </tr>
</table>

## Adding widget to your website
```html
<script type="text/javascript">
	(function(w,d,s,u,o){
    		w[o] = {
    			apiKey: '<api_key>',
    			spaceName: '<space_name>',
    			gameId: "<game_name>",
    			memberId: '<member_reference_id>',
    			language: "en",
    			uri: {
    				gatewayDomain: "https://gateway-staging.competitionlabs.com",
    				translationPath: "https://s3-eu-west-1.amazonaws.com/demo.competitionlabs.com/_widgets/leaderboard_v3/i18n/translation_:language.json"
    			},
    			resources: [
    				"https://s3-eu-west-1.amazonaws.com/demo.competitionlabs.com/_widgets/leaderboard_v3/css/style.css",
    				"https://s3-eu-west-1.amazonaws.com/demo.competitionlabs.com/_widgets/leaderboard_v3/css/fonts.css"
    			]
    		};
    		var a=d.createElement(s), m=d.getElementsByTagName(s)[0];
    		a.async=1;a.src=u;m.parentNode.insertBefore(a,m);
    	})(window,document,'script','https://s3-eu-west-1.amazonaws.com/demo.competitionlabs.com/_widgets/leaderboard_v3/javascript/leaderboard.v3.js',"_CLLBV3Opt");
</script>
```

## Using the loader script
You can use this loader script to centralise all your widget loading needs (custom scripts, styles and environmental parameters) into a single place.
The "Loader" script requires the bear minimum of 2 things to be set to the global `window._CLLBV3Opt` parameter before the scripts loads:
1) `gameId`
2) `memberId`
```html
<script type="text/javascript">
    window._CLLBV3Opt = {
        gameId: "my_game_id",
        memberId: "my_member_id"
    };
</script>
```
#### Steps required to configure the loader script:
1) update your default API key, space name (optional: `language` and `currency`), unless you are loading the API key and space name from your game/product
2) define what products will load in the widget:
```javascript
products: {
    "my_product_id": {
        script: "https://my.custom.script.location",
        resources: [
            "https://my.custom.stylesheet.location"
        ],
        onBeforeLoad: function( instance, options, callback ){ // your custom logic before the widget gets initialised/rendered
            if( typeof callback === "function" ) callback();
        }
    },
    "my_product_id_2": {}
}
```
3) add loader script to your website

## FAQ
### How do I set the currency:
The setting "currency" needs to be set to the appropriate ISO key used in [units of measure section](https://complabs.atlassian.net/wiki/spaces/CLRAV/pages/594935946/Units+of+Measure)
```text
{
  currency: "usd"
}
```

### How do I specify a custom stylesheet:
All styles are loaded as part of the initialisation, so overwriting the resources array variable with your stylesheet asset will allow you to load in the external stylesheets dynamically.
There is no limit to how many stylesheets you can add as the widget will load all of them from the specified array.

### How to show game/product specific competitions only:
```text
The setting "enforceGameLookup" should be set to "true" and game/product ID should be assigned to the setting entry "gameId" part of the widget startup/initialisation
{
  enforceGameLookup: true,
  gameId: "my_id"
}
```

### How to disable Inbox/Messaging section:
```text
To disable the inbox/messaging area on the full widget preview the following setting "messages.enabled" has to be set to "false":
{
  messages: {
      enable: false
  }
}
```

### How to show the widget only if there are any available competitions:
```text
The primary method “this.startup“ inside the "LbWidget" class is the one you should adjust to implement your scenario to achieve a pre-launch check, you can wrap what's inside of that method with the function:
this.checkForAvailableCompetitions()
This method collects all the necessary information about active, ready and finished competitions (example: _this.settings.tournaments.readyCompetitions will contain a list of upcoming competitions) so you can use the callback and the collected information to decide to show or hide the mini-scoreboard on startup based on your requirements.
```

### How do I only show the competition tab if there is an active competition only and/or change the default tab to the achievements tab

The current flow is:
1) once the mini scoreboard is clicked, the main layout gets initialized (unless it’s already not existing in the DOM)
2) the navigation then gets reset to the initial competition tab

To achieve this scenario you would need to do an available competition check prior to the navigation reset and then hide/show tabs accordingly based on your business requirement.
The code of interest would be on line inside the method called: "this.initLayout" in the "MainWidget" widget class, the method that resets the navigation is "_this.resetNavigation( callback )" this handles what navigation item to set as default for the user.
You can either change this code directly or override that method after initialization inside the "this.startup" method for the class "LbWidget" by doing the following "_this.settings.mainWidget.resetNavigation = function(callback){}". 
There you can write some logic that would check what tabs to show/hide. 
Or you can overwrite this on a more global scope level where you initialize the widget "new LbWidget(window._CLLBV3Opt)" as you get full access to the settings and all other methods.


### Localization - How do I translate the widget UI:
To enable translation the following steps need to be made:
1) Translate your UI elements to the appropriate language and save it in a ".json" format using the following naming pattern `translation_en.json` [JSON example](https://s3-eu-west-1.amazonaws.com/demo.competitionlabs.com/_widgets/leaderboard_v3/i18n/translation_en.json)
2) The translations you define inside the file will be merged with the core translations on run time

```text
* The default widget language is set to english "en", the widget will try to load look for an external translation 
resource based on the language setting and the "translationPath"

* If the resource path is used as "translation_:language.json" the widget script will try to replace ":language" with the 
current language  setting and load the translation dynamically from an external source, example:
https://s3-eu-west-1.amazonaws.com/demo.competitionlabs.com/_widgets/leaderboard_v3/i18n/translation_:language.json

* If translations are not required it is possible to disable them by changing "loadTranslations" setting to "false"
```

### Migrate to the latest modular NodeJS widget implementation:
I recommend following the following steps if you wish to use the latest modular NodeJS widget implementation, 
the following steps are only applicable and need to be taken if you did any custom changes/development on 
the source of the widget otherwise there is no need to change anything because the code is just modularized and will 
bundle/compile and work the same way as V2.0.0, it is backwards compatible:

_Steps_:
1) Make sure that the widget code you have is up to date with the `v2.0.0` branch  
2) Run a comparison (a diff check) of your code and the leaderboard widgets source code on branch `v2.0.0` to locate any custom differences you did  
3) Once the custom changes are located you can transfer those 1 at a time to the new code base on the `master` branch as the structure was just split apart into modules, components and utilities for ease of development and didn’t change much, it would still look familiar
4) The `README.md` file contains all the information you need to run/build the widget locally and build a production distributable 